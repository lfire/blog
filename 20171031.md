---
title: 复杂前端项目开发思考模型——H5小游戏
date: 2017-10-31 14:58:52
tags:
- 前端开发
- HTML5
categories:
- 前端开发

---

近期因为在筹划阐述前端开发工作中的各种复杂场景，并将其中可能用得上的思想讲明白，比如：模块化开发、自动化构建、工程化等，在每一个方向上，都是用于解决我们在项目开发过程中，所遇到的问题，以及提升工作效率的考虑，以此提升开发工作的趣味性。
> Not just do it, but enjoy it.

以此为砖，用以引玉。
<!-- more -->
正好近期也接受到了一个项目——《大富翁》小游戏，对于该项目的初步分析，并结合到我的想法，可能适合作为“复杂场景”的一个引子，我希望可以以该项目的实施及思考过程，来实例化的描述一下整体的一个解决思路。暂且叫其为：思（什）考（么）模（鬼）型。   
## 项目效果演示
先上个图，大致看一下最后的效果，没有将所有出现的情况全部展示。
<center>![GIF.gif-6957.5kB][1]
## 为什么可以说复杂
### 整体的游戏执行流程
<center>![流量大富翁流程图V3.jpg-1328.2kB][2]
这张图中可以看出游戏在执行过程中的逻辑流程，其中大部分都会涉及到前端交互的响应变化，因此其中前端交互流程复杂。
### 界面中元素众多
其中涉及到场景的元素非常多，各元素之间的排列，以及形状尺寸各不相同。这种场景下，给界面的兼容适配带来了难度。
### 界面元素涉及状态切换&动画执行
其中小狐狸的状态涉及到3种：静态、向左走动、向右走动。   
掷出骰子后，界面其他元素的交互触发需要锁定，并且，各元素的执行有明确的先后顺序，需要类似时间轴的概念来统一协调管理。
## 需要如何考虑
### 样式部分
界面非常的个性化，导致界面的样式布局上，我们很多场景需要使用背景图片来进行处理，另外，加上在不同尺寸终端上展示适配需求，更加使得整体问题变得复杂难解。
需要解决的点：

 - 各终端不同尺寸适配
 - 大部分为不规则的背景元素，CSS的编写过程，元素尺寸的快速管理
 - 页面动画过程中，元素位置的定位问题
 - 页面的样式有相近部分，如：弹窗，如何达到封装共用
 
**各终端不同尺寸适配**
目前市面上，可以统计到的不同终端尺寸，没有上百，也有几十，因此，在H5开发过程中，样式开发如何适配不同尺寸的显示屏，成为了我们这块所必须面对的首要问题。
***1. 媒体查询（media query）***
所涉及到的情况实在是太多，这导致，不同尺寸区间的细分会非常的复杂，而且，每一个尺寸区间下的都需要或多或少的人工干预调整，这在工作量上已经是无法实现的，还没考虑其中所涉及到的测试检验等等一系列的问题，所以，该方法基本可以排除。
***2. 百分比***
在CSS开发过程中，我们可以尝试使用百分比的方式来定位各不同元素在场景中的位置，以期在不同尺寸下达到同等比例的缩放。
这种思路很好，但技术选择方向上，百分比带来了很多的不可测量性，简单的来说，你拿到一个设计稿，其中一个元素相对于整体场景，或是另一个元素，具体较为精确的距离是百分之多少，这个没办法很直接的测量，因此，这种情况下，很多是由前端人员，依“手感”来细微的调整元素的位置，一个百分点，甚至零点几个百分点的来调整，而且调整完成后，由于各元素之间细微的误差积累，等放入另一个尺寸下时，你可能会发现，各要素的偏差很大，已经出现了我们常遇到的**不兼容**。
总结来说，就是工作量巨大，而且不兼容。
***3. REM***
REM是我实践过程中，认为的终极解决方案。当然，这其中我们要感谢很多在这方面提供解决方案的开源付出，如：[lib-flexible][3]，这就是其中的一个，具体的设计思路，可以详细去查阅本方向上的资料，这里不再展开。
附加的，会产生出另一个问题，REM，这个单位毕竟不是PX，仍需要换算。这里也同样有相应的解决方案，我们可以借用自动化的构建工具，实现rem和px之间的自动转换，[px2rem][4]，可以与gulp或grunt等构建工具集成，实现自动转换。
```less
.dock_head {
  position: fixed;
  background: url(../images/bg_head.png) no-repeat left -3px;
  background-size: cover;
  //left: 0;
  //right: 0;
  top: 0;
  width: 750px;
  height: image-height;
  .info {
    position: relative;
    float: left;
    height: 80px;
    padding-top: 20px;
    &.coin {
      margin: 65px 0 0 40px;
      float: left;
    }
  }
}
```
自动解析后：
```css
.dock_head {
  position: fixed;
  background: url(../images/bg_head.png) no-repeat left -0.04rem;
  background-size: cover;
  top: 0;
  width: 10rem;
  height: 2.24rem;
}

.dock_head .info {
  position: relative;
  float: left;
  height: 1.066667rem;
  padding-top: 0.266667rem;
}

.dock_head .info.coin {
  margin: 0.866667rem 0 0 0.533333rem;
  float: left;
}
```



### HTML部分

### JS部分

### 什么能交给工具


  [1]: http://static.zybuluo.com/lfire/74tw55hagfeblydaoapisnir/GIF.gif
  [2]: http://static.zybuluo.com/lfire/fwiihz6mb8gpn80objovvy77/%E6%B5%81%E9%87%8F%E5%A4%A7%E5%AF%8C%E7%BF%81%E6%B5%81%E7%A8%8B%E5%9B%BEV3.jpg
  [3]: https://github.com/amfe/lib-flexible
  [4]: https://www.npmjs.com/package/px2rem